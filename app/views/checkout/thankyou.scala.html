@import com.gu.i18n.Currency
@import com.gu.memsub.promo.Promotion.AnyPromotion
@import views.support.BillingPeriod._
@import views.support.PlanOps._
@import com.gu.memsub.subsv2.CatalogPlan
@import com.gu.memsub.Product
@import com.gu.memsub.subsv2.Subscription
@import com.gu.memsub.subsv2.SubscriptionPlan.ContentSubscription
@(
    subscription: Subscription[ContentSubscription],
    subscriptionName: String,
    guestAccountForm: Option[Form[model.GuestAccountData]] = None,
    touchpointBackendResolution: services.TouchpointBackend.Resolution,
    plan: CatalogPlan.Paid, // we should take a subscription here
    promotion: Option[AnyPromotion] = None,
    currency: Currency,
    startDate: String
)(implicit request: RequestHeader)

@main(s"Confirmation | Subscribe to the ${plan.title} | The Guardian", bodyClasses=List("is-wide"), touchpointBackendResolutionOpt = Some(touchpointBackendResolution), plan = Some(plan)) {

<script type="text/javascript">
    guardian.pageInfo.slug="GuardianDigiPack:Order Complete";
    guardian.pageInfo.productData = {
        numberOfMonths: @{plan.charges.billingPeriod.monthsInPeriod},
        // Omniture
        source: 'Subscriptions and Membership',
        type: 'GUARDIAN_DIGIPACK',
        eventName: 'purchase',
        amount: @{plan.charges.gbpPrice.amount},
        // Google Analytics
        zuoraId: '@subscriptionName',
        productType: '@plan.productType',
        productPurchased: '@plan.name'
    };
</script>

<main class="page-container gs-container gs-container--slim">
    @fragments.page.header("Thank you for subscribing", None, List("l-padded"))

    <section class="section-slice section-slice--bleed section-slice--limited">
        <div class="section-slice__content">
            <div class="prose prose--full">
                <p>
                    We have received your request and are now processing your subscription,
                    you'll receive email confirmation of this shortly.
                </p>
                <p>Here are the details of your subscription, if any of these are incorrect please get in touch with us straight away via email at
                    <a href="mailto:@plan.email">@plan.email</a> or on <strong>@plan.phone</strong>.
                    Lines open weekdays 8am-8pm, weekend 8pm-6pm.</p>
            </div>
            @fragments.checkout.reviewPanel(subscription, subscriptionName, plan, promotion, currency)
        </div>
    </section>

    <section class="section-slice section-slice--bleed section-slice--limited">
        <div class="section-slice__content">

            <h2 class="section-title">What happens now?</h2>

            <div class="steps">
                <h4 class="steps__title">Weâ€™ll send you an email confirming your subscription and payment information.</h4>
                @if(plan.isVoucher) {
                    <h4 class="steps__title">You will then receive your personalised book of vouchers.</h4>
                    <h4 class="steps__title">Take your vouchers to your newsagent or where you buy your paper.</h4>
                }
                @if(guestAccountForm.isDefined) {
                    <h4 class="steps__title">You can enter a password to manage your subscription online:</h4>
                    @fragments.confirmation.registerGuestAccount(guestAccountForm)
                }
                @if(plan.isHomeDelivery || plan.isGuardianWeekly) {
                    <h4 class="steps__title">Your first paper will be delivered on @startDate. </h4>
                    <h4 class="steps__title">You can set up any delivery holidays in our <a class="u-link" href="/manage">Subscription Management</a> area.</h4>
                }
                @if(plan.hasDigitalPack) { @fragments.confirmation.appSteps() }
            </div>

            <br/>
            <h4>We hope you enjoy your subscription.</h4>
        </div>
    </section>
</main>
    @{
        plan.product match {
            case _: Product.Weekly => fragments.analytics.jellyfish.weeklyConversion()
            case _ => fragments.analytics.jellyfish.conversion()
        }
    }
}
