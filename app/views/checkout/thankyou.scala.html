@import model.{GuestAccountData,PersonalData}
@import services.UserId.{paramName => userIdParam}
@import services.IdentityToken.{paramName => identityTokenParam}
@import configuration.Config.Identity.webAppProfileUrl

@import routes.Checkout.processFinishAccount

@(subscriptionName: String, personalData: PersonalData, guestAccountForm: Option[Form[GuestAccountData]] = None)(implicit request: RequestHeader)

@main("Thank you | Subscriptions | The Guardian", bodyClasses=List("is-wide")) {

<main class="page-container gs-container gs-container--slim">

    @fragments.page.header("Thank you for your order", classes=List("l-padded"))

    <section class="section-slice section-slice--limited">
        <div class="section-slice__content">
            <h2 class="section-title">Order ref: @subscriptionName</h2>
            <div class="prose prose--full">
                <p>
                    We have received your request and are now processing your subscription,
                    you'll receive email confirmation of this shortly.
                </p>
                <p>
                    Here are the details of your order, if any of these are incorrect
                    please get in touch with us straight away on 0800 123 456 or
                    <a href="mailto:subscriptions@@theguardian.com">subscriptions@@theguardian.com</a>
                </p>
            </div>
            @fragments.checkout.reviewPanel(subscriptionName, personalData)
        </div>
    </section>

    <section class="section-slice section-slice--limited">
        <div class="section-slice__content">

            <h2 class="section-title">What happens now?</h2>

            <h3 class="section-divider">Download your apps</h3>

            <div class="prose prose--full">
                <ol>
                    <li>Go to each device you want your subscription on and download the Guardian app</li>
                    <li>Open the app and tap the 'Settings' icon</li>
                    <li>Enter your subscription code (shown above and also in your confirmation email) and your postcode</li>
                </ol>
            </div>

            @guestAccountForm.map { form =>

                <h3 class="section-divider">Register for an account</h3>
                <div class="prose prose--full">
                    <p>Some features of your subscription require you to be signed in before you can make use of them.</p>
                </div>

                <form action="@processFinishAccount" method="POST" class="form js-finish-account">
                    @helper.CSRF.formField

                    <div class="form-field js-checkout-finish-account-password">

                        <input name="@userIdParam" type="hidden" value="@form.data.get(userIdParam)">
                        <input name="@identityTokenParam" type="hidden" value="@form.data.get(identityTokenParam)">

                        <label class="label" for="password">
                            Enter a password to finish creating your account:
                        </label>
                        <input
                            class="input-text js-input js-password-strength"
                            id="password"
                            name="password"
                            type="password"
                            minlength="6"
                            maxlength="20"
                            value=""
                           required
                        />
                        @checkout.errorMessage("Password too short")

                    </div>
                    @fragments.forms.passwordStrengthIndicator()

                    <div class="actions">
                        <button class="button button--primary button--large js-checkout-finish-account-submit">Confirm</button>
                    </div>
                </form>

                <div class="js-finish-account-success is-hidden">
                    <p>All done!</p>
                    <p>You can edit your details as well as manage your subscription in your Profile area</p>
                    <div class="actions">
                        <a href="@webAppProfileUrl" class="button button--primary button--large">My profile</a>
                    </div>
                </div>
                <div class="js-finish-account-error is-hidden finish-account-error">
                    <p>An internal server error occurred while trying to set a password for your account. Please try again later.</p>
                </div>
        }
        </div>
    </section>

    @fragments.promos.membershipPromo()
</main>
}
