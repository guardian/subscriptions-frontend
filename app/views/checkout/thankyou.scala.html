@import com.gu.i18n.Currency
@import com.gu.memsub.promo.Promotion.AnyPromotion
@import views.support.BillingPeriod._
@import views.support.Pricing._
@import com.gu.memsub.Digipack
@import views.support.PlanOps._
@import com.gu.subscriptions.ProductPlan
@import com.gu.subscriptions.ProductList
@import com.gu.memsub.Delivery
@(subscriptionName: String,
    guestAccountForm: Option[Form[model.GuestAccountData]] = None,
    touchpointBackendResolution: services.TouchpointBackend.Resolution,
    plan: ProductPlan[ProductList],
    promotion: Option[AnyPromotion] = None,
    currency: Currency,
    startDate: String
)(implicit request: RequestHeader)

@main(s"Confirmation | Subscribe to the ${plan.title} | The Guardian", bodyClasses=List("is-wide"), touchpointBackendResolutionOpt = Some(touchpointBackendResolution), plan = Some(plan)) {

    @fragments.analytics.tagmanager()

<script type="text/javascript">
    guardian.pageInfo.slug="GuardianDigiPack:Order Complete";
    guardian.pageInfo.productData = {
        // Omniture - TODO - fix the type field
        source: 'Subscriptions and Membership',
        type: 'GUARDIAN_DIGIPACK',
        eventName: 'purchase',
        amount: @{plan.gbpPrice.amount},
        frequency: @{plan.billingPeriod.numberOfMonths},
        // Google Analtics
        zuoraId: '@subscriptionName',
        productPurchased: '@plan.name'
    };
</script>

<main class="page-container gs-container gs-container--slim">
    @fragments.page.header("Thank you for subscribing", None, List("l-padded"))

    <section class="section-slice section-slice--bleed section-slice--limited">
        <div class="section-slice__content">
            <div class="prose prose--full">
                <p>
                    We have received your request and are now processing your subscription,
                    you'll receive email confirmation of this shortly.
                </p>
                <p>Here are the details of your subscription, if any of these are incorrect please get in touch with us straight away via email at
                    <a href="mailto:@plan.email">@plan.email</a> or on <strong>@plan.phone</strong>.
                    Lines are open BST Monday&ndash;Friday 8.00am&ndash;8.00pm. Saturday &amp; Sunday 8.00am&ndash;6.00pm.</p>
            </div>
            @fragments.checkout.reviewPanel(subscriptionName, plan, promotion, currency)
        </div>
    </section>

    <section class="section-slice section-slice--bleed section-slice--limited">
        <div class="section-slice__content">

            <h2 class="section-title">What happens now?</h2>

            <div class="steps">
                <h4 class="steps__title">Weâ€™ll send you an email confirming your subscription and payment information.</h4>
                @if(plan.products.seq.contains(Delivery)) {
                    <h4 class="steps__title">Your first paper will be delivered on @startDate. </h4>
                }
                @if(plan.products.seq.contains(Digipack)) { @fragments.confirmation.appSteps() }
            </div>

            @fragments.confirmation.registerGuestAccount(guestAccountForm)

            <br/>
            <h4>We hope you enjoy your subscription.</h4>
        </div>
    </section>
</main>
    @fragments.analytics.jellyfish.conversion()
}
