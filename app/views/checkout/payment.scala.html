@(form: Form[model.SubscriptionData], userIsSignedIn: Boolean, touchpointBackendResolution: services.TouchpointBackend.Resolution)(implicit request: RequestHeader)

@import model.JsVars
@import routes.Checkout.renderCheckout
@import configuration.Config.Identity._

@main(
    title = "Checkout | Subscriptions | The Guardian",
    jsVars = JsVars.default.copy(userIsSignedIn = userIsSignedIn),
    bodyClasses = List("is-wide"),
    touchpointBackendResolutionOpt = Some(touchpointBackendResolution)
) {
<main class="page-container gs-container">

    <section class="checkout-container">
        <form class="form js-checkout-form" action="@renderCheckout().toString()" method="POST" novalidate>
            @helper.CSRF.formField

            @fragments.checkout.checkoutHeader("Checkout")

            <div class="checkout-container__sidebar">
                @fragments.checkout.basketPreview(Some(touchpointBackendResolution.backend.zuoraService.products))
                <div class="u-display-from-tablet" data-set="checkout-notices">
                    <div class="js-append">
                        @fragments.checkout.notices()
                    </div>
                </div>
            </div>

            <div class="checkout-container__form">

                @if(form.errors.nonEmpty) {
                    <div class="flash-message flash-message--error">
                        This form has errors, please check your details and try again.
                    </div>
                }

                @* ===== Your details ===== *@
                <div id="yourDetails" class="field-panel js-fieldset-your-details">
                    <fieldset>
                        <legend class="field-panel__legend">
                            <span class="field-panel__legend__num">1</span> Your details
                        </legend>
                        <div class="field-panel__intro">
                            <div class="field-note field-note--offset">
                                @if(userIsSignedIn) {
                                    <a href="@idWebAppSignOutUrl(renderCheckout())">Sign out</a>
                                } else {
                                    <span class="field-note__label">Already have a Guardian account?</span>
                                    <a href="@idWebAppSigninUrl(renderCheckout())">Sign in</a>
                                }
                            </div>
                        </div>
                        <div class="field-panel__edit">
                            <a href="#yourDetails" class="text-button u-button-reset js-edit-your-details">Edit</a>
                        </div>
                        <div class="field-panel__fields">
                            @fragments.checkout.fieldsPersonal(form, userIsSignedIn)

                            <div class="actions">
                                <a href="#paymentDetails" class="button button--primary button--large js-checkout-your-details-submit">Continue</a>
                            </div>
                        </div>
                    </fieldset>
                </div>

                @* ===== Payment ===== *@
                <div id="paymentDetails" class="field-panel is-collapsed js-fieldset-payment-details">
                    <fieldset>
                        <legend class="field-panel__legend">
                            <span class="field-panel__legend__num">2</span> Payment details
                        </legend>
                        <div class="field-panel__intro">
                            <div class="field-note field-note--offset">
                                @fragments.forms.securityNote()
                                Payment will be taken by Direct Debit
                            </div>
                        </div>
                        <div class="field-panel__edit">
                            <a href="#paymentDetails" class="text-button u-button-reset js-edit-payment-details">Edit</a>
                        </div>
                        <div class="field-panel__fields">
                            @fragments.checkout.fieldsPayment(form)

                            <div class="actions">
                                <a href="#formReview" class="button button--primary button--large js-checkout-payment-details-submit">Continue</a>
                            </div>
                        </div>
                    </fieldset>
                </div>

                @* ===== Review ===== *@
                <div id="formReview" class="field-panel field-panel--single is-collapsed js-fieldset-review">
                    <fieldset>
                        <legend class="field-panel__legend">
                            <span class="field-panel__legend__num">3</span> Review and confirm
                        </legend>
                        <div class="field-panel__fields">
                            @fragments.checkout.reviewDetails(form)
                        </div>
                    </fieldset>
                </div>

            </div>

            <div class="u-display-until-tablet" data-set="checkout-notices"></div>

        </form>

    </section>

</main>
}
